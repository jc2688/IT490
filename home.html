<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Scene Sync Home</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="navbar-container"></div>
    <br>
    
    <div id="welcomeMessage"></div>

    <div id="recommendations">
        <!-- Recommendations will be dynamically added here -->
    </div>

    <script>
        const navbarContainer = document.getElementById('navbar-container');
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'components/navbar.html', true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                navbarContainer.innerHTML = xhr.responseText;
                validateSession();
                loadRecommendations();
            }
        };
        xhr.send();

        const sessionid = ('; ' + document.cookie).split('; sessionid=').pop().split(';')[0];
        const username = ('; ' + document.cookie).split('; username=').pop().split(';')[0];
        let sessionData = {
            sessionid: sessionid
        };

        function validateSession() {
            sessionData.type = "validate_session";

            $.ajax({
                url: 'sessionValidate.php',
                method: 'POST',
                data: sessionData,
                dataType: 'json',
                success: function (result) {
                    if (result.returnCode != "1") {
                        document.cookie = "sessionid=;username=;path='/'";
                        location.href = "index.html";
                    }
                },
                error: function () {
                    console.log("Error validating session");
                }
            });
        }

        function goToProfile() {
            location.href = "profile.php?u=" + encodeURIComponent(username);
        }

        function logout() {
            sessionData.type = "logout";

            $.ajax({
                url: 'sessionValidate.php',
                method: 'POST',
                data: sessionData,
                success: function () {
                    document.cookie = "sessionid=;path='/'";
                    document.cookie = "username=;path='/'";
                    location.href = "index.html";
                },
                error: function () {
                    console.log("Error logging out");
                }
            });
        }

        function setWelcomeMessage() {
            let welcomeMessage = document.getElementById("welcomeMessage");
            welcomeMessage.innerHTML = `Welcome, ${username} to Scene Sync! Try and find some movies you'd like based on ur preferences.`;
        }

        function loadRecommendations() {
        $.ajax({
            url: 'path/to/your/apiConsumer.php', // Replace with the actual URL
            method: 'POST', // Change to POST since we are sending data
            dataType: 'json',
            data: {
                type: 'displayRecommendedMovies', // Update to match the expected type in apiConsumer
                movieData: 'YOUR_MOVIE_DATA_VALUE', // Replace with the actual movie data
                source: 'YOUR_SOURCE_VALUE' // Replace with the actual source data
            },
            success: function (result) {
                // Handle the success response if needed
            },
            error: function () {
                console.log("Error loading recommendations");
            }
        });
    }

        setWelcomeMessage();
    </script>
</body>
</html>
