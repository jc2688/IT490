<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>About username</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css"> <!-- Include your CSS file -->
</head>
<body>
    <div id="navbar-container"></div>
    
    <h1>About username</h1>

    <div id="username">
        <h2>Username</h2>
        <p id="username-info"></p>
    </div>

    <div id="actor">
        <h2>Favorite Actor</h2>
        <p id="actor-info"></p>
        <button id="edit-actor" style="display: none;">Edit</button>
    </div>

    <div id="movie">
        <h2>Favorite Movie</h2>
        <p id="movie-info"></p>
        <button id="edit-movie" style="display: none;">Edit</button>
    </div>

    <div id="director">
        <h2>Favorite Director</h2>
        <p id="director-info"></p>
        <button id="edit-director" style="display: none;">Edit</button>
    </div>

    <div id="genre">
        <h2>Favorite Genre</h2>
        <p id="genre-info"></p>
        <button id="edit-genre" style="display: none;">Edit</button>
    </div>

    <div id="rate">
        <h2>Rate Score</h2>
        <p id="rate-info"></p>
    </div>

    <div id="bio">
        <h2>Bio</h2>
        <p id="bio-info"></p>
        <button id="edit-bio" style="display: none;">Edit</button>
    </div>

    <script>
        // Load the navbar component
        const navbarContainer = document.getElementById('navbar-container');
    
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'components/navbar.html', true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                navbarContainer.innerHTML = xhr.responseText;
    
                // Call other functions after the navbar is loaded (if needed)
                loadProfileData();
    
                // Event listener for the "Profile" link in the navbar
                $('#profile-link').click(function (event) {
                    event.preventDefault(); // Prevent the default link behavior
                    loadProfileData("<?php echo $_SESSION['username']; ?>");
                });
    
                // Check if it's the user's own profile page to enable edit functionality
                const isOwnProfile = isCurrentUserProfile(); // Function to check if it's the user's own profile
                if (isOwnProfile) {
                    enableEditFunctionality();
                }
            }
        };
        xhr.send();
    
        function isCurrentUserProfile() {
            const currentSessionUsername = "<?php echo $_SESSION['username']; ?>";
            const profileUsername = "<?php echo isset($_GET['username']) ? $_GET['username'] : $_SESSION['username']; ?>";
            return currentSessionUsername === profileUsername;
        }
    
        function loadProfileData(username) {
            // Fetch data from our backend (PHP) and populate the respective sections. NEEDS TO BE CHANGED FOR ACTUAL FUNCTIONS
            // Use AJAX to get the user's favorite director, movie, and bio.
            // Populate the elements with the received data.
            $.ajax({
                url: 'RabbitMQ/getProfileData.php', // Replace with actual file and command 
                method: 'GET',
                data: { username: username }, // Pass the username as a parameter
                dataType: 'json',
                success: function (result) {
                    if (result.username) {
                        $('#username-info').text(result.username);
                    }
                    if (result.actor) {
                        $('#actor-info').text(result.actor);
                        $('#edit-actor').show();
                    }
                    if (result.movie) {
                        $('#movie-info').text(result.movie);
                        $('#edit-movie').show();
                    }
                    if (result.director) {
                        $('#director-info').text(result.director);
                        $('#edit-director').show();
                    }
                    if (result.genre) {
                        $('#genre-info').text(result.genre);
                        $('#edit-genre').show();
                    }
                    if (result.rate) {
                        $('#rate-info').text(result.rate);
                    }
                    if (result.bio) {
                        $('#bio-info').text(result.bio);
                        $('#edit-bio').show();
                    }
                },
                error: function () {
                    console.log("Error loading profile data");
                }
            });
        }
    
        // Add edit functionality here
    
        function enableEditFunctionality() {
            $('#edit-actor').show();
            $('#edit-movie').show();
            $('#edit-director').show();
            $('#edit-genre').show();
            $('#edit-bio').show();
    
            $('#edit-actor').click(function () {
                // Logic to enable editing favorite actor information
                // (show input field, submit button, etc.)
            });
    
            $('#edit-movie').click(function () {
                // Logic to enable editing favorite movie information
                // (show input field, submit button, etc.)
            });
    
            $('#edit-director').click(function () {
                // Logic to enable editing favorite director information
                // (show input field, submit button, etc.)
            });
    
            $('#edit-genre').click(function () {
                // Logic to enable editing favorite genre information
                // (show input field, submit button, etc.)
            });
    
            $('#edit-bio').click(function () {
                // Logic to enable editing biography information
                // (show input field, submit button, etc.)
            });
        }
    
        // Rest of my functions...
    </script>
    
</body>
</html>
    